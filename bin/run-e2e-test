#!/usr/bin/env bash
set -euxo pipefail

# capture token addresses
export CONTRACT_OAXToken=$(cat deploy.json | jq -r .assets.OAX)
export CONTRACT_ETHToken=$(cat deploy.json | jq -r .assets.WETH)
export CONTRACT_Mediator=$(cat deploy.json | jq -r .mediator)
export OPERATOR_ADDRESS=$(cat deploy.json | jq -r .operator)
export FEE_AMOUNT_ETHER=$(cat .env.example | grep FEE_AMOUNT_ETHER | cut -d = -f 2)
export DOCKER_E2E=1

export TEST_TIMEOUT=30000

pnpm run clean-build
jest --bail 1 --verbose build/dist/tests/e2e/main.test.js

docker stop oax-e2e
